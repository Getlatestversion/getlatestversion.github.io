<!doctype html><html class=nojs lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>The limit is your own imagination, do it with Azure DevOps Services REST API – GetLatestVersion – Europe</title><meta name=description content="We have taken advantage of the API Rest made available by Azure DevOps through a script in PowerShell to perform release activities."><meta name=created content="2021-11-03T03:00:00+0200"><meta name=modified content="2021-11-03T03:00:00+0200"><meta name=contact content="info@getlatestversion.eu"><meta property="og:site_name" content="GetLatestVersion – Europe"><meta property="og:title" content="The limit is your own imagination, do it with Azure DevOps Services REST API"><meta property="og:url" content="http://www.getlatestversion.eu/2021/11/the-limit-is-your-own-imagination-do-it-with-azure-devops-services-rest-api/"><meta property="og:type" content="article"><meta name=generator content="Hugo 0.68.3"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=canonical href=http://www.getlatestversion.eu/2021/11/the-limit-is-your-own-imagination-do-it-with-azure-devops-services-rest-api/><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=stylesheet href=/css/mobile.2ab74aa64785dcab8114959e76ca140cf76207cd85989bc6d4fc3b12f734a09e.css media=screen><link rel=stylesheet href=/css/styles.07de9722ae74190da91740ecb1e12bbfa31de324e29ab4972bdcc4131519528c.css><link rel=stylesheet href=/css/print.27fc184f8670f41a2690985390779e7b20335a8fadff8fa015cf9417ffe50c36.css media=print><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The limit is your own imagination, do it with Azure DevOps Services REST API","datePublished":"2021-11-03T03:00:00+02:00","dateModified":"2021-11-03T03:00:00+02:00","url":"http://www.getlatestversion.eu/2021/11/the-limit-is-your-own-imagination-do-it-with-azure-devops-services-rest-api/","description":"We have taken advantage of the API Rest made available by Azure DevOps through a script in PowerShell to perform release activities.","keywords":["azure devops rest api","powershell"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://www.getlatestversion.eu/"},"publisher":{"@type":"Organization","name":"GetLatestVersion – Europe","url":"http://www.getlatestversion.eu/"}}</script><script defer src=/js/lib/umbrella.min.b426107371d121c9a56a27aac9e9058ff592a021e2f4c3c94827fe70920d3cbb.js></script><script defer src=/js/mobile.min.3a3510028bab9810834389725137cfa50f5d3231799ef9ac70769331fa59859a.js></script><script defer src=/js/script.min.8e4d91ebe0d9226621e408b7205bd7b009e4935608e4b29c4275116490cc836d.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-165859091-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js></script><script src=http://www.getlatestversion.eu/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=http://www.getlatestversion.eu/css/jquery-eu-cookie-law-popup.css><script>$(document).ready(function(){$(document).euCookieLawPopup().init({cookiePolicyUrl:'/page/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});});</script></head><body class=single-page><div class="page layout__page layout__sidebar-second"><header class="header layout__header"><a href=/ title=Home rel=home class=header__logo><img src=/images/logo.png alt=Home class=header__logo-image></a><h1 class=header__site-name><a href=/ title=Home class=header__site-link rel=home><span>GetLatestVersion – Europe</span></a></h1><div class="region header__region"><h2 class=visually-hidden>Language selector</h2><nav class="language-selector layout__language-selector"><ul class=navbar><li><a rel=alternate href=/it hreflang=it lang=it>Italiano</a></li></ul></nav></div></header><nav class="main-menu layout__navigation"><h2 class=visually-hidden>Main menu</h2><ul class=navbar><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li><li><a href=/authors/>Authors</a></li><li><a href=/about/>About</a></li></ul></nav><main class="main layout__main"><article class="section-post single-view"><header><h1 class="title title-submitted">The limit is your own imagination, do it with Azure DevOps Services REST API</h1><div class=submitted><a href=/authors/bartlombardi><span class=author itemprop=author>Bartolomeo Lombardi</span></a>
<a href=/authors/Andrea%20Sturiale><span class=author itemprop=author></span></a>- <time class=created-date datetime=2021-11-03T03:00:00+02:00>3 November, 2021</time></div><div class=tags>Tags:<ul><li><a href=/tags/azure-devops-rest-api>azure devops rest api</a></li><li><a href=/tags/powershell>powershell</a></li></ul></div></header><div class=content><p>Azure DevOps is the platform signed by Microsoft that helps software factories to improve the development process, automatic tests and frequent releases. Their aim is to have additional value for the end customer in terms of product quality.</p><p>With Azure DevOps Release you can separate the delivery environments into groups, obtaining integration, acceptance, production environments and so on. Most of time, the pipelines are configured to release the artifacts related to the main branches. However, Azure DevOps doesn&rsquo;t allow to modify easily a specific release for a single target within a Deployment Group (DG) starting from different artifacts.</p><h1 id=automated-through-the-azure-devops-services-rest-api>Automated through the Azure DevOps Services REST API</h1><p>Consider a scenario in which we have a DG called &ldquo;integration&rdquo; that collects 20 virtual machines (VMs), one for each developer. Through this DG we can use a pipeline that deploys the latest version of the product to all the VMs at the same time. Anyway, more often a developer wants to test a release with his own changes before merging on the main branch. He needs to deploy his build to only his VM, without involving the others. It&rsquo;s onerous for him unless he&rsquo;s an Azure DevOps user, capable of modifying his deployment group, the branch where to download the artifacts, etc. It&rsquo;s possible to automate all the previous steps needed to launch a release only on your target environment, starting from a particular artifact.</p><p>In the following the steps to achive it:</p><ol><li>set a new tag to the VM in the DG</li><li>put the tag into release pipeline</li><li>launch the release pipeline</li><li>remove the tag from DG and release pipeline</li></ol><p>We have taken advantage of the <a href="https://docs.microsoft.com/en-us/rest/api/azure/devops/?view=azure-devops-rest-6.1">Azure DevOps Services REST API</a> made available by Azure DevOps through a script in PowerShell.
Here there are the essential steps:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>Write-Host <span style=color:#e6db74>&#34;Adding tag for your VM in the Deployment Group: $deploymentGroup&#34;</span>
$UriOrga = <span style=color:#e6db74>&#34;https://dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/distributedtask/deploymentgroups/&#34;</span> + $DeploymentGroupId + <span style=color:#e6db74>&#34;/targets?api-version=6.0-preview.1&#34;</span>
$output = Invoke-RestMethod -Uri $UriOrga -Method get -Headers $AzureDevOpsAuthenicationHeader 
$UriOrga = <span style=color:#e6db74>&#34;https://dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/distributedtask/deploymentgroups/&#34;</span> + $DeploymentGroupId + <span style=color:#e6db74>&#34;/targets?api-version=6.0-preview.1&#34;</span>
Invoke-RestMethod -Method Patch -Uri $UriOrga -Headers $AzureDevOpsAuthenicationHeader -Body $TargetVMs -ContentType application/json

Write-Host <span style=color:#e6db74>&#34;Adding tag to Deployment Group stage in the Realese Pipeline&#34;</span>
$UriOrga = <span style=color:#e6db74>&#34;https://vsrm.dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/release/definitions/&#34;</span> + $ReleaseDefinitionId + <span style=color:#e6db74>&#34;?api-version=6.0&#34;</span>
$UpdateEnvironmentsBody = Invoke-RestMethod -Uri $UriOrga -Method Get -Headers $AzureDevOpsAuthenicationHeader -ContentType application/json 
$UpdateEnvironmentsBody.environments[0].deployPhases[0].deploymentInput.tags = @( $Tag )
$UpdateEnvironmentsBody = ConvertTo-Json $UpdateEnvironmentsBody -Depth 10
$UriOrga = <span style=color:#e6db74>&#34;https://vsrm.dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/release/definitions?api-version=6.0&#34;</span>
Invoke-RestMethod -Uri $UriOrga -Method Put -Headers $AzureDevOpsAuthenicationHeader -Body $UpdateEnvironmentsBody -ContentType application/json 

Write-Host <span style=color:#e6db74>&#34;Launching Release Pipeline for your VM&#34;</span>
$UriOrga = <span style=color:#e6db74>&#34;https://vsrm.dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/release/releases?api-version=6.0&#34;</span>
$CreateReleaseBody = ConvertTo-Json $CreateReleaseBody -Depth 10
Invoke-RestMethod -Uri $UriOrga -Method Post -Headers $AzureDevOpsAuthenicationHeader -Body $CreateReleaseBody -ContentType application/json 

Write-Host <span style=color:#e6db74>&#34;Removing all tags from Deployment Group stage in the Realese Pipeline&#34;</span>
$UriOrga = <span style=color:#e6db74>&#34;https://vsrm.dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/release/definitions/&#34;</span> + $ReleaseDefinitionId + <span style=color:#e6db74>&#34;?api-version=6.0&#34;</span>
$UpdateEnvironmentsBody = Invoke-RestMethod -Uri $UriOrga -Method Get -Headers $AzureDevOpsAuthenicationHeader -ContentType application/json 
$UpdateEnvironmentsBody.environments[0].deployPhases[0].deploymentInput.tags = @()
$UpdateEnvironmentsBody = ConvertTo-Json $UpdateEnvironmentsBody -Depth 10
$UriOrga = <span style=color:#e6db74>&#34;https://vsrm.dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/release/definitions?api-version=6.0&#34;</span>
Invoke-RestMethod -Uri $UriOrga -Method Put -Headers $AzureDevOpsAuthenicationHeader -Body $UpdateEnvironmentsBody -ContentType application/json 
</code></pre></div><h1 id=conclusion>Conclusion</h1><p>Like any Azure service, Microsoft&rsquo;s DevOps counterpart can also be managed by a set of APIs that replicate everything that can be done through the portal. First you need to get a <a href="https://docs.microsoft.com/it-it/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=preview-page">PAT (Personal Access Token)</a> through which you can authenticate inside your organization.
Then you can take advantage of any tool that invokes API Rest to do whatever you want, i.e. launching Release, creating or modifying Deployment Groups, starting specific Tests and so on. This can be a hint to create a user-friendly interface for developers not accustomed to DevOps. It could automate set of actions that would be otherwise onerous.</p><p>In these cases the limit is your own imagination.</p><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"www-getlatestversion-eu"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></main><aside class="sidebar layout__second-sidebar"><section><h4 class=menu><a href=/post/ class=active aria-current=page>Posts</a></h4><ul class=menu><li><a href=/2021/11/the-limit-is-your-own-imagination-do-it-with-azure-devops-services-rest-api/ class=active aria-current=page>The limit is your own imagination, do it with Azure DevOps Services REST API</a></li><li><a href=/2020/08/migrating-work-items-from-jira-to-azure-devops/>Migrating work items from Jira to Azure DevOps</a></li><li><a href=/2020/07/git-cherry-pick-for-a-strategic-harvest/>Git Cherry-Pick for a strategic harvest</a></li><li><a href=/2020/06/flaky-builds/>Flaky builds</a></li><li><a href=/2020/05/top-10-pipeline-mistakes/>Top 10 Pipeline mistakes</a></li><li><a href=/2020/05/code-dependencies-binary-composition-is-not-only-a-mathematics-calculation/>Code dependencies: Binary Composition is not only a mathematics calculation</a></li><li><a href=/2020/05/reducing-the-gap-between-operations-and-development-using-azure-devops/>Reducing the gap between operations and development using Azure DevOps</a></li></ul></section><section><h4 class=menu><a href=/page/>Pages</a></h4><ul class=menu><li><a href=/page/privacy/>Privacy</a></li></ul></section></aside><footer class="footer layout__footer"><p>© 2020 GetLatestVersion</p><p>A <a href=http://www.getlatestversion.eu/>GetLatestVersion</a> production. <a href=/page/privacy>Privacy policy</a></p><p>Powered by <a href=https://gohugo.io/>Hugo</a> and the <a href=https://github.com/frjo/hugo-theme-zen>Zen theme</a>.</p></footer></div><div class=mobile-nav dir=ltr><div class=mobile-nav__cover></div><a href=#navigation class=mobile-nav__toggle aria-haspopup=true role=button>Menu</a><div class=mobile-nav__sheet><div class=mobile-nav__region><h2 class=visually-hidden>Language selector</h2><nav class="language-selector layout__language-selector"><ul class=navbar><li><a rel=alternate href=/it hreflang=it lang=it>Italiano</a></li></ul></nav></div><nav class=mobile-nav__main-menu><h2 class=visually-hidden>Main menu</h2><ul class=mobile-nav__navbar><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li><li><a href=/authors/>Authors</a></li><li><a href=/about/>About</a></li></ul></nav></div></div></body></html>